<story-context id="epic-16/story-16-4" v="1.0">
  <metadata>
    <epicId>16</epicId>
    <storyId>16.4</storyId>
    <title>Advertiser-Friendly Scoring</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/16-4-advertiser-friendly-scoring.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Leader</asA>
    <iWant>biết content có advertiser-friendly không</iWant>
    <soThat>tôi maximize ad revenue</soThat>
    <tasks>
      <backend>
        <task>Create AdvertiserFriendlyService with scoreAdFriendliness method</task>
        <task>Build sensitive topics database</task>
        <task>Add adjustment suggestions</task>
        <task>Add ad-friendly report and trends</task>
      </backend>
      <frontend>
        <task>Create AdFriendlyScoreCard component</task>
        <task>Create SensitiveTopicsList component</task>
        <task>Create AdFriendlyReport component</task>
        <task>Create AdFriendlyTrends component</task>
      </frontend>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Given content, When user request ad-friendly score, Then score và flag sensitive topics</criterion>
    <criterion id="2">Given ad-friendly analysis, When user xem details, Then hiển thị breakdown by category</criterion>
    <criterion id="3">Given flagged content, When user xem recommendations, Then suggest adjustments</criterion>
    <criterion id="4">Given content library, When user xem ad-friendly report, Then show percentage of ad-friendly content</criterion>
    <criterion id="5">Given ad-friendly trends, When user xem dashboard, Then show improvement over time</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/stories/16-1-quality-score-dashboard.md">Prerequisite story</doc>
    </docs>
    <code>
      <existingPatterns>
        <pattern path="libraries/nestjs-libraries/src/database/prisma/quality/">Quality services</pattern>
      </existingPatterns>
      <newFiles>
        <file>libraries/nestjs-libraries/src/database/prisma/quality/advertiser-friendly.service.ts</file>
        <file>apps/frontend/src/components/quality/ad-friendly-score-card.tsx</file>
        <file>apps/frontend/src/components/quality/sensitive-topics-list.tsx</file>
        <file>apps/frontend/src/components/quality/ad-friendly-report.tsx</file>
      </newFiles>
    </code>
    <dependencies>
      <dependency>Story 16.1 complete (Quality Score Dashboard)</dependency>
    </dependencies>
  </artifacts>

  <interfaces>
    <api>
      <endpoint method="GET" path="/api/quality/ad-friendly/:contentId">Score single content ad-friendliness</endpoint>
      <endpoint method="GET" path="/api/quality/ad-friendly/report">Get ad-friendly report</endpoint>
      <endpoint method="GET" path="/api/quality/ad-friendly/trends">Get ad-friendly trends</endpoint>
    </api>
    <dataModels>
      <model name="AdFriendlyScore">
        <field name="overallScore" type="number">0-100</field>
        <field name="categoryScores" type="object">Scores by category</field>
        <field name="flaggedTopics" type="array">Detected sensitive topics</field>
        <field name="suggestions" type="array">Improvement suggestions</field>
      </model>
      <model name="SensitiveTopic">
        <field name="category" type="string">Topic category</field>
        <field name="detected" type="string">What was detected</field>
        <field name="impact" type="string">Impact on ads</field>
        <field name="suggestion" type="string">How to fix</field>
      </model>
    </dataModels>
  </interfaces>

  <sensitiveTopicCategories>
    <category name="violence" impact="Limited/No ads">Fighting, weapons, gore</category>
    <category name="adult" impact="No ads">Sexual content, nudity</category>
    <category name="controversial" impact="Limited ads">Politics, religion debates</category>
    <category name="drugs" impact="Limited ads">Drug use, excessive alcohol</category>
    <category name="profanity" impact="Limited ads">Strong language, slurs</category>
    <category name="tragedy" impact="Limited ads">Death, disasters</category>
    <category name="misinformation" impact="No ads">False claims, conspiracy</category>
  </sensitiveTopicCategories>

  <scoreInterpretation>
    <range min="90" max="100">Fully ad-friendly, all advertisers</range>
    <range min="70" max="89">Mostly ad-friendly, some restrictions</range>
    <range min="50" max="69">Limited ad-friendly, many restrictions</range>
    <range min="0" max="49">Not ad-friendly, minimal/no ads</range>
  </scoreInterpretation>

  <assumption>MVP uses keyword-based detection. Phase 2 will add NLP/ML for context-aware detection.</assumption>
</story-context>
