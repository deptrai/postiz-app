<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Analytics Intelligence module scaffold (backend + FE route stub)</title>
    <status>drafted</status>
    <generatedAt>2025-12-13</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-analytics-intelligence-module-scaffold.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Leader (owner)</asA>
    <iWant>a new “Analytics Intelligence” module scaffold in Postiz (backend module + minimal FE route stub)</iWant>
    <soThat>MVP analytics features can be developed incrementally without breaking existing Postiz behavior</soThat>
    <tasks>
- Create backend scaffold for Analytics Intelligence (AC: #1)
  - Decide placement: extend existing analytics module vs create dedicated controller/service
  - Add stub endpoint for Daily Brief under /analytics/daily-brief returning mock payload
  - Ensure endpoint is org-scoped using existing Postiz patterns
  - Add minimal DTO validation (date/groupId/format)
  - Testing: minimal integration test (smoke)
- Create frontend route stub for Daily Brief (AC: #2)
  - Add placeholder page/screen under existing analytics area
  - Wire FE call to stub endpoint (optional)
  - Testing: basic rendering smoke
    </tasks>
  </story>

  <acceptanceCriteria>
1) Given Postiz codebase is runnable (apps/backend + apps/frontend), when creating the backend module (NestJS) and a FE route stub for Daily Brief, then the system builds/runs without errors and exposes a stub endpoint returning mock data.
2) And the FE route (or analytics sub-tab) renders a placeholder screen for the new Daily Brief area.
  </acceptanceCriteria>

  <artifacts>
    <docs>
- path: docs/epics.md
  title: postiz-app - Epic Breakdown
  section: Story 1.1
  snippet: Story 1.1 defines creating a backend module scaffold plus a FE route stub, and suggests initial API paths under /analytics (daily-brief, playbooks, themes).
- path: docs/PRD.md
  title: postiz-app - Product Requirements Document
  section: User Experience Principles / Functional Requirements (Daily Brief)
  snippet: PRD emphasizes action-first Daily Brief as default screen and requires explainability for recommendations (FR-014/FR-015).
- path: docs/architecture.md
  title: Architecture
  section: Implementation Patterns / API Contracts
  snippet: Architecture mandates org-scoped API patterns, REST controllers under /analytics, and advises not inventing new response wrappers.
- path: docs/tech-spec.md
  title: postiz-app — Tech Spec (Facebook Page Analytics)
  section: API Contracts (MVP)
  snippet: Tech spec enumerates the analytics endpoints, including /analytics/daily-brief, and documents shared query primitives (date, groupId, format).
    </docs>

    <code>
- path: apps/backend/src/api/routes/analytics.controller.ts
  kind: controller
  symbol: AnalyticsController
  lines: 19-63
  reason: Existing analytics controller already exposes /analytics and /analytics/trending and shows org extraction pattern via GetOrgFromRequest.
- path: apps/frontend/src/app/(app)/(site)/analytics/page.tsx
  kind: route
  symbol: default export Index
  lines: 1-11
  reason: Existing analytics page route; can be extended or used as reference for adding Daily Brief entry point.
- path: apps/frontend/src/components/analytics/analytics.component.tsx
  kind: component
  symbol: AnalyticsComponent
  lines: 1-30
  reason: Demonstrates FE fetching patterns (useFetch + SWR) against /analytics and /analytics/trending.
- path: apps/frontend/src/components/platform-analytics/platform.analytics.tsx
  kind: component
  symbol: PlatformAnalytics
  lines: 31-296
  reason: Current analytics UI for integrations; reference for placing new UI without breaking existing routes.
    </code>

    <dependencies>
- ecosystem: node
  manifest: package.json
  notable:
    - nestjs (core/common) and swagger
    - next.js
    - bullmq and redis
    - prisma/@prisma/client
    - swr
    - jest (test runner)
    </dependencies>
  </artifacts>

  <constraints>
- Do not introduce a new API response wrapper; follow existing Postiz response conventions. [Source: docs/architecture.md#API-Contracts]
- Keep scope scaffold-only: no DB schema changes here (Story 1.2), no ingestion logic here (Story 1.3/Epic 2). [Source: docs/stories/1-1-analytics-intelligence-module-scaffold.md#Dev-Notes]
- Prefer existing org scoping/auth patterns for protected endpoints (e.g., org extraction from request, JWT guard patterns). [Source: apps/backend/src/api/routes/analytics.controller.ts]
  </constraints>

  <interfaces>
- name: GET /analytics
  kind: REST endpoint
  signature: GET /analytics
  path: apps/backend/src/api/routes/analytics.controller.ts
- name: GET /analytics/trending
  kind: REST endpoint
  signature: GET /analytics/trending
  path: apps/backend/src/api/routes/analytics.controller.ts
- name: Planned stub: GET /analytics/daily-brief
  kind: REST endpoint
  signature: GET /analytics/daily-brief?date=&amp;groupId=&amp;format=
  path: docs/tech-spec.md
  </interfaces>

  <tests>
    <standards>Backend and shared logic should be covered with Jest (repo test script uses jest). Prefer minimal smoke/integration test for the stub endpoint and basic FE render smoke for the new placeholder route.</standards>
    <locations>
- Backend: apps/backend/**
- Frontend: apps/frontend/**
- Jest entry: root package.json scripts.test
    </locations>
    <ideas>
- AC1: Integration test calling GET /analytics/daily-brief with auth/org context returns mock payload and HTTP 200.
- AC2: FE route renders placeholder without crashing and (optionally) can fetch stub endpoint.
    </ideas>
  </tests>
</story-context>
