<story-context id="epic-14/story-14-3" v="1.0">
  <metadata>
    <epicId>14</epicId>
    <storyId>14.3</storyId>
    <title>Optimal Viral Timing</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/14-3-optimal-viral-timing.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Leader</asA>
    <iWant>biết thời điểm tốt nhất để viral</iWant>
    <soThat>tôi maximize reach potential</soThat>
    <tasks>
      <backend>
        <task>Create ViralTimingService with getOptimalViralTiming method</task>
        <task>Analyze historical viral content timing</task>
        <task>Add format-specific timing analysis</task>
        <task>Add niche-specific timing</task>
        <task>Add API endpoints for viral timing</task>
      </backend>
      <frontend>
        <task>Create ViralTimingCard component</task>
        <task>Create TimingHeatmap component</task>
        <task>Create FormatTimingTabs component</task>
      </frontend>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Given historical viral content data, When user request optimal timing, Then recommend posting windows cho viral potential</criterion>
    <criterion id="2">Given audience activity patterns, When calculating timing, Then factor in audience online times</criterion>
    <criterion id="3">Given content format, When user request timing, Then provide format-specific recommendations</criterion>
    <criterion id="4">Given niche/group context, When calculating timing, Then customize recommendations per niche</criterion>
    <criterion id="5">Given timing recommendations, When user xem details, Then hiển thị confidence level và historical success rate</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/stories/14-1-viral-score-prediction.md">Prerequisite story</doc>
    </docs>
    <code>
      <existingPatterns>
        <pattern path="libraries/nestjs-libraries/src/database/prisma/viral/viral-score.service.ts">ViralScoreService</pattern>
        <pattern path="libraries/nestjs-libraries/src/database/prisma/analytics/analytics-best-time.service.ts">Best time patterns if exists</pattern>
      </existingPatterns>
      <newFiles>
        <file>libraries/nestjs-libraries/src/database/prisma/viral/viral-timing.service.ts</file>
        <file>apps/frontend/src/components/viral/viral-timing-card.tsx</file>
        <file>apps/frontend/src/components/viral/timing-heatmap.tsx</file>
      </newFiles>
    </code>
    <dependencies>
      <dependency>Story 14.1 complete (Viral Score Service)</dependency>
      <dependency>Historical posting data with timestamps</dependency>
    </dependencies>
  </artifacts>

  <interfaces>
    <api>
      <endpoint method="GET" path="/api/viral/timing">Get optimal viral timing</endpoint>
      <endpoint method="GET" path="/api/viral/timing/heatmap">Get timing heatmap data</endpoint>
    </api>
    <dataModels>
      <model name="ViralTiming">
        <field name="optimalWindows" type="array">List of optimal time windows</field>
        <field name="format" type="string">Reels or Post</field>
        <field name="niche" type="string">Niche/group name</field>
        <field name="confidence" type="string">high/medium/low</field>
        <field name="successRate" type="number">Historical success rate</field>
      </model>
      <model name="TimeWindow">
        <field name="dayOfWeek" type="string">Day of week</field>
        <field name="startHour" type="number">Start hour (0-23)</field>
        <field name="endHour" type="number">End hour (0-23)</field>
        <field name="score" type="number">Effectiveness score</field>
      </model>
    </dataModels>
  </interfaces>

  <timingAnalysisApproach>
    <step>Analyze viral content posting times</step>
    <step>Cross-reference with audience activity</step>
    <step>Weight by engagement velocity (early engagement)</step>
    <step>Segment by format and niche</step>
  </timingAnalysisApproach>

  <optimalWindowsExample>
    <format name="reels">7-9 AM, 12-2 PM, 7-10 PM</format>
    <format name="posts">9-11 AM, 1-3 PM, 6-8 PM</format>
  </optimalWindowsExample>

  <confidenceLevels>
    <level name="high">More than 100 data points, greater than 70% success rate</level>
    <level name="medium">50-100 data points, 50-70% success rate</level>
    <level name="low">Less than 50 data points, less than 50% success rate</level>
  </confidenceLevels>
</story-context>
