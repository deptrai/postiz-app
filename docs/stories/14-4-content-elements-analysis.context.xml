<story-context id="epic-14/story-14-4" v="1.0">
  <metadata>
    <epicId>14</epicId>
    <storyId>14.4</storyId>
    <title>Content Elements Analysis</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/14-4-content-elements-analysis.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Leader</asA>
    <iWant>phân tích elements của viral content</iWant>
    <soThat>tôi có thể replicate success</soThat>
    <tasks>
      <backend>
        <task>Create ContentElementsService with analyzeContentElements method</task>
        <task>Implement Caption Analyzer</task>
        <task>Implement Hashtag Analyzer</task>
        <task>Implement Format Analyzer</task>
        <task>Implement CTA Analyzer</task>
        <task>Add API endpoints for content elements</task>
      </backend>
      <frontend>
        <task>Create ContentElementsCard component</task>
        <task>Create CaptionAnalysis component</task>
        <task>Create HashtagAnalysis component</task>
        <task>Create FormatAnalysis component</task>
        <task>Create CTAAnalysis component</task>
      </frontend>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Given top-performing content, When user request elements analysis, Then breakdown: caption style, hashtags, format, CTA</criterion>
    <criterion id="2">Given caption analysis, When user xem details, Then hiển thị: length, tone, keywords, emoji usage</criterion>
    <criterion id="3">Given hashtag analysis, When user xem details, Then hiển thị: count, trending status, relevance score</criterion>
    <criterion id="4">Given format analysis, When user xem details, Then hiển thị: Reels vs Post performance, video length impact</criterion>
    <criterion id="5">Given CTA analysis, When user xem details, Then hiển thị: CTA types used, effectiveness by type</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/stories/14-1-viral-score-prediction.md">Prerequisite story</doc>
    </docs>
    <code>
      <existingPatterns>
        <pattern path="libraries/nestjs-libraries/src/database/prisma/viral/">Viral services</pattern>
      </existingPatterns>
      <newFiles>
        <file>libraries/nestjs-libraries/src/database/prisma/viral/content-elements.service.ts</file>
        <file>apps/frontend/src/components/viral/content-elements-card.tsx</file>
        <file>apps/frontend/src/components/viral/caption-analysis.tsx</file>
        <file>apps/frontend/src/components/viral/hashtag-analysis.tsx</file>
      </newFiles>
    </code>
    <dependencies>
      <dependency>Story 14.1 complete (Viral Score Service)</dependency>
      <dependency>Content metadata available</dependency>
    </dependencies>
  </artifacts>

  <interfaces>
    <api>
      <endpoint method="GET" path="/api/viral/elements/:contentId">Analyze single content elements</endpoint>
      <endpoint method="GET" path="/api/viral/elements/patterns">Get successful element patterns</endpoint>
    </api>
    <dataModels>
      <model name="ContentElements">
        <field name="captionAnalysis" type="CaptionAnalysis">Caption breakdown</field>
        <field name="hashtagAnalysis" type="HashtagAnalysis">Hashtag breakdown</field>
        <field name="formatAnalysis" type="FormatAnalysis">Format breakdown</field>
        <field name="ctaAnalysis" type="CTAAnalysis">CTA breakdown</field>
      </model>
      <model name="CaptionAnalysis">
        <field name="length" type="string">short/medium/long</field>
        <field name="characterCount" type="number">Character count</field>
        <field name="tone" type="string">casual/professional/humorous/educational</field>
        <field name="keywords" type="array">Extracted keywords</field>
        <field name="emojiCount" type="number">Number of emojis</field>
      </model>
      <model name="HashtagAnalysis">
        <field name="count" type="number">Number of hashtags</field>
        <field name="hashtags" type="array">List of hashtags with scores</field>
        <field name="trendingCount" type="number">Number of trending hashtags</field>
        <field name="relevanceScore" type="number">Overall relevance</field>
      </model>
      <model name="CTAAnalysis">
        <field name="hasCTA" type="boolean">Whether CTA present</field>
        <field name="ctaType" type="string">engagement/action/save/share</field>
        <field name="effectiveness" type="number">CTA effectiveness score</field>
      </model>
    </dataModels>
  </interfaces>

  <captionAnalysisFactors>
    <factor name="length">Short (less than 50 chars), Medium (50-150), Long (more than 150)</factor>
    <factor name="tone">Casual, Professional, Humorous, Educational</factor>
    <factor name="keywords">Top keywords from viral content</factor>
    <factor name="emoji">Count and placement</factor>
  </captionAnalysisFactors>

  <hashtagAnalysis>
    <factor name="count">Optimal range 5-15 for Facebook</factor>
    <factor name="trending">Check against trending hashtags</factor>
    <factor name="relevance">Match with content topic</factor>
  </hashtagAnalysis>

  <ctaTypes>
    <type name="engagement">Comment below, Share your thoughts</type>
    <type name="action">Click link, Follow for more</type>
    <type name="save">Save for later</type>
    <type name="share">Tag a friend</type>
  </ctaTypes>

  <formatInsights>
    <format name="reels">Higher reach, shorter attention span</format>
    <format name="posts">Better for detailed content, longer engagement</format>
  </formatInsights>
</story-context>
